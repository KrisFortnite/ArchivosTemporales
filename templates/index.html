<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archivos Temporales</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #333333;
            color: #ffffff;
            margin: 0;
            padding: 20px;
        }
        h1, h2 {
            color: #cccccc;
        }
        #fileInput {
            display: none;
        }
        #uploadButton {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
        }
        #progressBar {
            width: 100%;
            background-color: #ddd;
        }
        #progressBar div {
            width: 0%;
            height: 30px;
            background-color: #4CAF50;
            text-align: center;
            line-height: 30px;
            color: white;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            margin-bottom: 10px;
        }
        a {
            color: #4CAF50;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>Archivos Temporales</h1>
    <input type="file" id="fileInput" multiple>
    <button id="uploadButton">Seleccionar archivos</button>
    <div id="progressBar"><div></div></div>
    
    <h2>Archivos en cola</h2>
    <ul id="queueList"></ul>
    
    <h2>Archivos subidos</h2>
    <ul id="fileList"></ul>

    <script>
        const fileInput = document.getElementById('fileInput');
        const uploadButton = document.getElementById('uploadButton');
        const progressBar = document.getElementById('progressBar').firstElementChild;
        const queueList = document.getElementById('queueList');
        const fileList = document.getElementById('fileList');

        uploadButton.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', () => {
            Array.from(fileInput.files).forEach(file => {
                uploadFile(file);
            });
        });

        function uploadFile(file) {
            const queueItem = document.createElement('li');
            queueItem.textContent = file.name;
            queueList.appendChild(queueItem);

            const xhr = new XMLHttpRequest();
            const formData = new FormData();
            formData.append('file', file);

            xhr.upload.onprogress = (event) => {
                if (event.lengthComputable) {
                    const percentComplete = (event.loaded / event.total) * 100;
                    progressBar.style.width = percentComplete + '%';
                    progressBar.textContent = percentComplete.toFixed(2) + '%';
                }
            };

            xhr.onload = () => {
                if (xhr.status === 200) {
                    queueList.removeChild(queueItem);
                    updateFileList();
                } else {
                    console.error('Error al subir el archivo:', xhr.statusText);
                }
            };

            xhr.open('POST', '/upload', true);
            xhr.send(formData);
        }

        function updateFileList() {
            fetch('/files')
                .then(response => response.json())
                .then(files => {
                    fileList.innerHTML = '';
                    files.forEach(file => {
                        const li = document.createElement('li');
                        const link = document.createElement('a');
                        link.href = `/download/${file.name}`;
                        link.textContent = `${file.name} (${formatSize(file.size)}) - ${formatTime(file.remaining_time)}`;
                        li.appendChild(link);
                        fileList.appendChild(li);
                    });
                });
        }

        function formatSize(bytes) {
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            if (bytes === 0) return '0 Byte';
            const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
            return Math.round(bytes / Math.pow(1024, i), 2) + ' ' + sizes[i];
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}m ${remainingSeconds}s`;
        }

        setInterval(updateFileList, 1000);
    </script>
</body>
</html>
